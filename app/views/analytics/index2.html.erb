<svg id="graph"></svg>

<script>
$.ajax({
  url: '/analytics/1',
  dataType: 'json'
}).success(function(data){
  draw(data)
})


function draw(data) {
    var color = d3.scale.category20b();
    var width = 1200,
        height = 500;
        // barHeight = 20;
    var barWidth = width / data[0].length;

    var y = d3.scale.linear()
        .range([height, 0])
        .domain([0, d3.max(data[1])]);

    var chart = d3.select("#graph")
        .attr("width", width)
        .attr("height", height);

    var bar = chart.selectAll("g")
        .data(data[1])
        .enter().append("g")
        .attr("transform", function (d, i) {
                  return "translate(" + i * barWidth + ",0)";
              });

    bar.append("rect")
        .attr("y", function(d) { return y(d); })
        .attr("width", barWidth-1)
        .attr("height", function(d) { return height - y(d); })
        .style("fill", function (d) {
                   return color(d)
               })

    // bar.append("rect")
    // .attr("y", function(d) { return y(d.value); })
    // .attr("height", function(d) { return height - y(d.value); })
    // .attr("width", barWidth - 1);

  //  bar.append("text")
  //    .attr("x", barWidth / 2)
  //    .attr("y", function(d) { return y(d.value) + 3; })
  //    .attr("dy", ".75em")
  //    .text(function(d) { return d.value; });

    bar.append("text")
        .data(data[1])
        // .attr("y", function (d) {
        //           return y(d) -10;
        //       })
        .attr("y",height-20)
        .attr("x", barWidth / 2)
        .attr("dy", ".35em")
        .style("fill", "black")
        .text(function (d) {
          // debugger;
                  return d;
              });
              // .attr("transform", "rotate(90)" )
              // .attr("transform", "translate(-50)" );

    var chart = d3.select(".chart")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    chart.append("g")
    .attr("class", "y axis")
    .call(yAxis)
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Frequency");
}
</script>
